<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–π–º–∏ –º–æ–π —à–∏–ø –∑–∞ 5 –º–∏–Ω—É—Ç</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Marck+Script&family=Playfair+Display:wght@700&family=Roboto:wght@400;700&family=Bad+Script&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #e8e0d8;
            font-family: 'Roboto', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
        }

        #sheet-container {
            width: 900px;
            background: #fff;
            border: 3px solid #000;
            padding: 25px;
            position: relative;
        }

        /* ========== TOP SECTION ========== */
        .top-section {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .character-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .name-label {
            font-family: 'Playfair Display', serif;
            font-size: 16px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .name-label::before, .name-label::after {
            content: '';
            width: 40px;
            height: 1px;
            background: #000;
        }

        .name-input {
            width: 100%;
            border: 2px solid #000;
            padding: 5px 10px;
            font-family: 'Bad Script', cursive;
            font-size: 18px;
            text-align: center;
            background: transparent;
            outline: none;
            margin-bottom: 8px;
        }

        .portrait-area {
            width: 220px;
            height: 260px;
            border: 3px solid #000;
            position: relative;
            cursor: pointer;
            overflow: hidden;
            background: #f9f9f9;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º background-size: cover –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫—Ä–æ–ø–∞ –±–µ–∑ –∏—Å–∫–∞–∂–µ–Ω–∏–π –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ */
        .uploaded-portrait-div {
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .portrait-placeholder {
            text-align: center;
            color: #999;
            font-size: 13px;
            pointer-events: none;
            position: absolute; /* –ß—Ç–æ–±—ã –Ω–µ –º–µ—à–∞—Ç—å –¥–∏–≤—É —Å –∫–∞—Ä—Ç–∏–Ω–∫–æ–π */
            z-index: 1;
        }

        .portrait-placeholder svg {
            width: 60px;
            height: 60px;
            fill: #ccc;
            margin-bottom: 5px;
        }

        /* Center stats panel */
        .center-stats {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
            min-width: 200px;
        }

        .stat-block {
            text-align: center;
            width: 100%;
        }

        .stat-block-label {
            font-family: 'Playfair Display', serif;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .stat-main-value {
            border: 2px solid #000;
            padding: 4px 12px;
            font-family: 'Bad Script', cursive;
            font-size: 22px;
            text-align: center;
            width: 100px;
            margin: 0 auto 6px;
            background: transparent;
            outline: none;
            display: block;
        }

        .stat-pair {
            display: flex;
            gap: 8px;
            justify-content: center;
        }

        .stat-pair input {
            border: 2px solid #000;
            padding: 4px 8px;
            font-family: 'Bad Script', cursive;
            font-size: 18px;
            text-align: center;
            width: 80px;
            background: transparent;
            outline: none;
        }

        /* Gender & Orientation */
        .gender-orient-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 10px;
        }

        .info-field {
            display: flex;
            flex-direction: column;
        }

        .info-field label {
            font-family: 'Playfair Display', serif;
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 3px;
        }

        .info-field input[type="text"] {
            border: 2px solid #000;
            padding: 5px 10px;
            font-family: 'Bad Script', cursive;
            font-size: 16px;
            background: transparent;
            outline: none;
        }

        /* ====== ORIENTATION SELECTOR ====== */
        .orientation-selector {
            width: 100%;
        }

        .orientation-selector select {
            width: 100%;
            border: 2px solid #000;
            padding: 6px 10px;
            font-family: 'Roboto', sans-serif;
            font-size: 13px;
            background: #fff;
            outline: none;
            cursor: pointer;
            appearance: auto;
        }

        .orient-flag-display {
            margin-top: 6px;
            position: relative;
            height: 36px;
            border: 2px solid #000;
            overflow: hidden;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .orient-flag-display.active {
            display: flex;
        }

        .orient-flag-stripes {
            position: absolute;
            inset: 0;
            display: flex;
        }

        .orient-flag-stripes .flag-stripe {
            flex: 1;
            transition: background 0.3s;
        }

        .orient-flag-label {
            position: relative;
            z-index: 2;
            font-family: 'Playfair Display', serif;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: #fff;
            text-shadow:
                1px 1px 2px rgba(0,0,0,0.8),
                -1px -1px 2px rgba(0,0,0,0.8),
                1px -1px 2px rgba(0,0,0,0.8),
                -1px 1px 2px rgba(0,0,0,0.8),
                0 0 6px rgba(0,0,0,0.5);
            pointer-events: none;
            white-space: nowrap;
        }

        /* ========== TITLE ========== */
        .main-title {
            text-align: center;
            font-family: 'Playfair Display', serif;
            font-size: 22px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 3px;
            border: 3px solid #000;
            padding: 10px 25px;
            margin: 15px auto;
            display: inline-block;
        }

        .title-wrapper {
            text-align: center;
            margin-bottom: 20px;
        }

        /* ========== SCALES SECTION ========== */
        .scales-and-figures {
            display: grid;
            grid-template-columns: 1fr 250px;
            gap: 20px;
            margin-top: 15px;
        }

        .scales-section {
            border: 1px solid #ccc;
            padding: 10px;
        }

        .scale-row {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            position: relative;
            height: 36px;
        }

        .scale-label-left {
            font-size: 11px;
            font-weight: 700;
            text-align: right;
            width: 140px;
            padding-right: 8px;
            line-height: 1.2;
            flex-shrink: 0;
        }

        .scale-label-right {
            font-size: 11px;
            font-weight: 700;
            text-align: left;
            width: 140px;
            padding-left: 8px;
            line-height: 1.2;
            flex-shrink: 0;
        }

        .scale-track {
            flex: 1;
            height: 4px;
            background: #000;
            position: relative;
            cursor: pointer;
            min-width: 100px;
        }

        .scale-track::before, .scale-track::after {
            content: '';
            position: absolute;
            top: -6px;
            width: 2px;
            height: 16px;
            background: #000;
        }

        .scale-track::before { left: 0; }
        .scale-track::after { right: 0; }

        .scale-track .midline {
            position: absolute;
            left: 50%;
            top: -4px;
            width: 1px;
            height: 12px;
            background: #999;
        }

        .scale-dot {
            position: absolute;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            cursor: grab;
            z-index: 10;
            border: 2px solid rgba(0,0,0,0.3);
        }

        .scale-dot:active { cursor: grabbing; }
        .scale-dot.dot-1 { background: #6a5acd; }
        .scale-dot.dot-2 { background: #2ea82e; }

        /* ========== FIGURES SECTION ========== */
        .figures-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .figure-group {
            text-align: center;
        }

        .figure-group-title {
            font-family: 'Playfair Display', serif;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .figure-bodies {
            display: flex;
            justify-content: center;
            gap: 6px;
        }

        .figure-body {
            width: 65px;
            height: 130px;
            cursor: pointer;
            position: relative;
        }

        .figure-body svg {
            width: 100%;
            height: 100%;
        }

        /* ========== COLOR PICKERS ========== */
        .color-picker-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 5px;
            justify-content: center;
        }

        .color-picker-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            font-weight: 700;
        }

        .color-swatch {
            width: 22px;
            height: 22px;
            border: 2px solid #000;
            border-radius: 3px;
            cursor: pointer;
            position: relative;
        }

        .color-swatch input[type="color"] {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        /* ========== BOTTOM ========== */
        .footer-text {
            text-align: center;
            font-family: 'Playfair Display', serif;
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-top: 15px;
            padding-top: 10px;
            border-top: 2px solid #000;
        }

        /* ========== BUTTONS ========== */
        .controls {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 700;
            border: 3px solid #000;
            background: #fff;
            cursor: pointer;
            font-family: 'Playfair Display', serif;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.2s;
        }

        .btn:hover {
            background: #000;
            color: #fff;
        }

        .btn-save {
            background: #2ea82e;
            color: #fff;
            border-color: #1a7a1a;
        }

        .btn-save:hover {
            background: #1a7a1a;
        }

        input[type="file"] {
            display: none;
        }

        .instructions {
            max-width: 900px;
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            font-size: 14px;
            line-height: 1.6;
        }

        .instructions h3 {
            margin-bottom: 8px;
            color: #856404;
        }

        .instructions ul {
            padding-left: 20px;
        }

        .instructions li {
            margin-bottom: 4px;
        }
    </style>
</head>
<body>

<div class="instructions">
    <h3>üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</h3>
    <ul>
        <li><strong>–ü–æ—Ä—Ç—Ä–µ—Ç—ã:</strong> –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Ä–∞–º–∫—É –ø–æ—Ä—Ç—Ä–µ—Ç–∞, —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</li>
        <li><strong>–®–∫–∞–ª—ã:</strong> –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ —Ü–≤–µ—Ç–Ω—ã–µ —Ç–æ—á–∫–∏ –ø–æ —à–∫–∞–ª–∞–º (—Ñ–∏–æ–ª–µ—Ç–æ–≤–∞—è = –ø–µ—Ä—Å–æ–Ω–∞–∂ 1, –∑–µ–ª—ë–Ω–∞—è = –ø–µ—Ä—Å–æ–Ω–∞–∂ 2)</li>
        <li><strong>–§–∏–≥—É—Ä—ã:</strong> –ö–ª–∏–∫–∞–π—Ç–µ –ø–æ –Ω—É–∂–Ω–æ–π –≤—ã—Å–æ—Ç–µ —Ñ–∏–≥—É—Ä–∫–∏ ‚Äî –∑–∞–ª–∏–≤–∫–∞ –ø–æ–¥–Ω–∏–º–µ—Ç—Å—è –¥–æ —ç—Ç–æ–≥–æ —É—Ä–æ–≤–Ω—è. –ú–æ–∂–Ω–æ –∑–∞–∂–∞—Ç—å –º—ã—à—å –∏ –≤–æ–¥–∏—Ç—å –≤–≤–µ—Ä—Ö-–≤–Ω–∏–∑</li>
        <li><strong>–¶–≤–µ—Ç–∞:</strong> –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞–ª–∏—Ç—Ä—ã –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ü–≤–µ—Ç–æ–≤ –∫–∞–∂–¥–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</li>
        <li><strong>–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è:</strong> –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ ‚Äî –ø–æ—è–≤–∏—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Ñ–ª–∞–≥</li>
        <li><strong>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:</strong> –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ¬´–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ PNG¬ª –≤–Ω–∏–∑—É</li>
    </ul>
</div>

<div id="sheet-container">
    <!-- TOP SECTION -->
    <div class="top-section">
        <!-- Character 1 -->
        <div class="character-panel" id="char1-panel">
            <div class="name-label">–ò–ú–Ø</div>
            <input type="text" class="name-input" id="name1" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è...">
            <div class="portrait-area" id="portrait1-area" onclick="document.getElementById('portrait1-input').click()">
                <div class="portrait-placeholder" id="portrait1-placeholder">
                    <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                    <div>–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏</div>
                </div>
                <!-- –ó–∞–º–µ–Ω–∞ img –Ω–∞ div –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫—Ä–æ–ø–∞ -->
                <div id="portrait1-img" class="uploaded-portrait-div" style="display:none;"></div>
            </div>
            <input type="file" id="portrait1-input" accept="image/*" onchange="loadPortrait(1, this)">
        </div>

        <!-- Center Stats -->
        <div class="center-stats">
            <div class="stat-block">
                <div class="stat-block-label">–†–∞–∑–Ω–∏—Ü–∞ –≤ —Ä–æ—Å—Ç–µ</div>
                <input type="text" class="stat-main-value" id="height-diff" placeholder="‚Äî" readonly>
                <div class="stat-pair">
                    <input type="number" id="height1" placeholder="–†–æ—Å—Ç" oninput="calcDiff('height')">
                    <input type="number" id="height2" placeholder="–†–æ—Å—Ç" oninput="calcDiff('height')">
                </div>
            </div>
            <div class="stat-block">
                <div class="stat-block-label">–†–∞–∑–Ω–∏—Ü–∞ –≤ –≤–æ–∑—Ä–∞—Å—Ç–µ</div>
                <input type="text" class="stat-main-value" id="age-diff" placeholder="‚Äî" readonly>
                <div class="stat-pair">
                    <input type="number" id="age1" placeholder="–í–æ–∑—Ä–∞—Å—Ç" oninput="calcDiff('age')">
                    <input type="number" id="age2" placeholder="–í–æ–∑—Ä–∞—Å—Ç" oninput="calcDiff('age')">
                </div>
            </div>
        </div>

        <!-- Character 2 -->
        <div class="character-panel" id="char2-panel">
            <div class="name-label">–ò–ú–Ø</div>
            <input type="text" class="name-input" id="name2" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è...">
            <div class="portrait-area" id="portrait2-area" onclick="document.getElementById('portrait2-input').click()">
                <div class="portrait-placeholder" id="portrait2-placeholder">
                    <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                    <div>–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏</div>
                </div>
                <!-- –ó–∞–º–µ–Ω–∞ img –Ω–∞ div –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∫—Ä–æ–ø–∞ -->
                <div id="portrait2-img" class="uploaded-portrait-div" style="display:none;"></div>
            </div>
            <input type="file" id="portrait2-input" accept="image/*" onchange="loadPortrait(2, this)">
        </div>
    </div>

    <!-- GENDER & ORIENTATION ROW -->
    <div class="gender-orient-section">
        <div>
            <div class="info-field">
                <label>–ü–æ–ª:</label>
                <input type="text" id="gender1" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª...">
            </div>
            <div class="info-field" style="margin-top:8px;">
                <label>–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è:</label>
                <div class="orientation-selector" id="orient-sel-1">
                    <select id="orient-select-1" onchange="setOrientation(1, this.value)">
                        <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é ‚Äî</option>
                        <option value="hetero">–ì–µ—Ç–µ—Ä–æ</option>
                        <option value="bi">–ë–∏</option>
                        <option value="pan">–ü–∞–Ω</option>
                        <option value="gay">–ì–µ–π</option>
                        <option value="lesbian">–õ–µ—Å–±–∏</option>
                        <option value="ace">–ê—Å–µ–∫—Å—É–∞–ª</option>
                        <option value="aro">–ê—Ä–æ–º–∞–Ω—Ç–∏–∫</option>
                    </select>
                    <div class="orient-flag-display" id="orient-flag-1">
                        <div class="orient-flag-stripes" id="orient-stripes-1"></div>
                        <span class="orient-flag-label" id="orient-label-1"></span>
                    </div>
                </div>
            </div>
        </div>
        <div>
            <div class="info-field">
                <label>–ü–æ–ª:</label>
                <input type="text" id="gender2" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª...">
            </div>
            <div class="info-field" style="margin-top:8px;">
                <label>–û—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è:</label>
                <div class="orientation-selector" id="orient-sel-2">
                    <select id="orient-select-2" onchange="setOrientation(2, this.value)">
                        <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é ‚Äî</option>
                        <option value="hetero">–ì–µ—Ç–µ—Ä–æ</option>
                        <option value="bi">–ë–∏</option>
                        <option value="pan">–ü–∞–Ω</option>
                        <option value="gay">–ì–µ–π</option>
                        <option value="lesbian">–õ–µ—Å–±–∏</option>
                        <option value="ace">–ê—Å–µ–∫—Å—É–∞–ª</option>
                        <option value="aro">–ê—Ä–æ–º–∞–Ω—Ç–∏–∫</option>
                    </select>
                    </select>
                    <div class="orient-flag-display" id="orient-flag-2">
                        <div class="orient-flag-stripes" id="orient-stripes-2"></div>
                        <span class="orient-flag-label" id="orient-label-2"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MAIN TITLE -->
    <div class="title-wrapper">
        <div class="main-title">–ü–û–ô–ú–ò –ú–û–ô –®–ò–ü –ó–ê 5 –ú–ò–ù–£–¢</div>
    </div>

    <!-- COLOR PICKERS FOR CHARACTERS -->
    <div class="color-picker-row">
        <div class="color-picker-item">
            <span>–¶–≤–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ 1:</span>
            <div class="color-swatch" id="swatch1" style="background:#6a5acd;">
                <input type="color" id="color1" value="#6a5acd" onchange="updateCharColor(1, this.value)">
            </div>
        </div>
        <div class="color-picker-item">
            <span>–¶–≤–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ 2:</span>
            <div class="color-swatch" id="swatch2" style="background:#2ea82e;">
                <input type="color" id="color2" value="#2ea82e" onchange="updateCharColor(2, this.value)">
            </div>
        </div>
    </div>

    <!-- SCALES AND FIGURES -->
    <div class="scales-and-figures">
        <div class="scales-section" id="scales-section"></div>
        <div class="figures-section" id="figures-section"></div>
    </div>

    <div class="footer-text">–®–ê–ë–õ–û–ù –°–î–ï–õ–ê–ù GIBSLYTHE</div>
</div>

<div class="controls">
    <button class="btn btn-save" onclick="saveToPNG()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ PNG</button>
    <button class="btn" onclick="resetAll()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
// ========== DATA ==========
const scalesData = [
    { left: '–ë–æ–ª—å—à–∞—è –ª–æ–∂–∫–∞', right: '–ú–∞–ª–µ–Ω—å–∫–∞—è –ª–æ–∂–∫–∞' },
    { left: '–î–∞—ë—Ç —Å–≤–æ—é –æ–¥–µ–∂–¥—É', right: '–ë–µ—Ä—ë—Ç —á—É–∂—É—é –æ–¥–µ–∂–¥—É' },
    { left: '–ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–∑–≤–∏—â–∞', right: '–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–∑–≤–∏—â–∞' },
    { left: '–ò–Ω—Ç—Ä–æ–≤–µ—Ä—Ç', right: '–≠–∫—Å—Ç—Ä–∞–≤–µ—Ä—Ç' },
    { left: '–°–∏–º–ø–∞—Ç–∏—è —á–µ—Ä–µ–∑ —Å–ª–æ–≤–∞', right: '–°–∏–º–ø–∞—Ç–∏—è —á–µ—Ä–µ–∑ –¥–µ–π—Å—Ç–≤–∏—è' },
    { left: '–ü—Ä–∏–∑–Ω–∞—ë—Ç—Å—è –ø–µ—Ä–≤—ã–º', right: '–ñ–¥—ë—Ç –ø—Ä–∏–∑–Ω–∞–Ω–∏—è' },
    { left: '–ö—Ä–∏—á–∏—Ç –ø—Ä–∏ –≤–∏–¥–µ –∂—É–∫–æ–≤', right: '–†–∞–∑–¥–∞–≤–ª–∏–≤–∞–µ—Ç –∏—Ö —Ç–∞–ø–∫–æ–º' },
    { left: '–í–æ–¥–∏—Ç –º–∞—à–∏–Ω—É', right: '–ù–µ –º–æ–∂–µ—Ç –≤–æ–¥–∏—Ç—å, –ª–æ–ª' },
    { left: '–î–µ—Ä—å–º–æ–≤–æ –≥–æ—Ç–æ–≤–∏—Ç', right: '–ì–æ—Ç–æ–≤–∏—Ç —É–∂–∏–Ω' },
    { left: '–ù–µ –ª—é–±–∏—Ç –ü–ü–°', right: '–õ—é–±–∏—Ç –ü–ü–°' },
    { left: '–ì–∏–ø–µ—Ä–æ–ø–µ–∫–∞—é—â–∏–π', right: '–ù–µ –ø–∞—Ä–∏—Ç—Å—è' },
    { left: '–ò–º–µ–µ—Ç –±–æ–ª—å—à–µ –æ–ø—ã—Ç–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π', right: '–ù–ï –∏–º–µ–µ—Ç –æ–ø—ã—Ç–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏–π' }
];

const figureGroups = [
    { title: '–£–†–û–í–ï–ù–¨ –°–ï–ö–°–£–ê–õ–¨–ù–û–ì–û<br>–ñ–ï–õ–ê–ù–ò–Ø', id: 'flirt' },
    { title: '–£–†–û–í–ï–ù–¨ –ù–ï–õ–û–í–ö–û–°–¢–ò', id: 'awkward' },
    { title: '–£–†–û–í–ï–ù–¨ –†–ï–í–ù–û–°–¢–ò', id: 'jealousy' }
];

let charColors = {
    1: '#6a5acd',
    2: '#2ea82e'
};

// ========== ORIENTATION FLAGS DATABASE ==========
const orientationFlags = {
    hetero: {
        name: '–ì–µ—Ç–µ—Ä–æ',
        stripes: ['#000000', '#7e7e7e', '#ffffff', '#7e7e7e', '#000000']
    },
    bi: {
        name: '–ë–∏',
        stripes: ['#d60270', '#d60270', '#9b4f96', '#0038a8', '#0038a8']
    },
    pan: {
        name: '–ü–∞–Ω',
        stripes: ['#ff218c', '#ff218c', '#ffd800', '#ffd800', '#21b1ff', '#21b1ff']
    },
    ace: {
        name: '–ê—Å–µ–∫—Å—É–∞–ª',
        stripes: ['#000000', '#a4a4a4', '#ffffff', '#810081']
    },
    aro: {
        name: '–ê—Ä–æ–º–∞–Ω—Ç–∏–∫',
        stripes: ['#3da542', '#a7d379', '#ffffff', '#a9a9a9', '#000000']
    },

    lesbian: {
        name: '–õ–µ—Å–±–∏',
        stripes: ['#d52d00', '#ef7627', '#ff9a56', '#ffffff', '#d162a4', '#b55690', '#a30262']
    },
    gay: {
        name: '–ì–µ–π',
        stripes: ['#078d70', '#26ceaa', '#98e8c1', '#ffffff', '#7bade2', '#5049cc', '#3d1a78']
    }
};

// ========== ORIENTATION HANDLER ==========
function setOrientation(charNum, value) {
    const flagDisplay = document.getElementById(`orient-flag-${charNum}`);
    const stripesContainer = document.getElementById(`orient-stripes-${charNum}`);
    const label = document.getElementById(`orient-label-${charNum}`);

    if (!value || !orientationFlags[value]) {
        flagDisplay.classList.remove('active');
        stripesContainer.innerHTML = '';
        label.textContent = '';
        return;
    }

    const flag = orientationFlags[value];

    stripesContainer.innerHTML = '';
    flag.stripes.forEach(color => {
        const stripe = document.createElement('div');
        stripe.className = 'flag-stripe';
        stripe.style.background = color;
        stripesContainer.appendChild(stripe);
    });

    label.textContent = flag.name;
    flagDisplay.classList.add('active');
}

// ========== SILHOUETTE SVG ==========
function createSilhouetteSVG(groupId, figIndex) {
    const uid = `${groupId}-${figIndex}`;

    // Single path containing the whole figure from your provided SVG
    const figurePath = `M173.85,2c72.28,0,79.17,50.04,72.28,85.28,24.51-13.02,42.89,.77,33.7,28.34s-16.85,30.64-37.53,22.98c-29.81,49.31-53.56,12.81-46.72,62.04,77.46,14.43,110.26,84.67,150.12,140.94,0,0-77.36,49.01-77.36,49.01l13.02,26.04s97.28,5.36-6.13,23.74c-20.3-20.3-35.62-35.62-35.62-35.62-2.69-46.16,14.65-51.63,43.28-80.81-7.81-7.41-43.73-22.39-36.77-37.53-.04,33.71-4.99,90.67-6.77,124.21-4.48,12.9,26.88,225.71,28.47,243.45,0,0,92.94,36.25,28.6,40.85-64.34,4.6-64.34-11.74-64.34-11.74,0,0-58.23-250.72-58.23-250.72 M173.85,2c-72.28,0-79.17,50.04-72.28,85.28-24.51-13.02-42.89,.77-33.7,28.34s16.85,30.64,37.53,22.98c29.81,49.31,53.56,12.81,46.72,62.04C74.66,215.07,41.86,285.31,2,341.58c0,0,77.36,49.01,77.36,49.01l-13.02,26.04s-97.28,5.36,6.13,23.74c20.3-20.3,35.62-35.62,35.62-35.62,2.69-46.16-14.65-51.63-43.28-80.81,7.81-7.41,43.73-22.39,36.77-37.53,.04,33.71,4.99,90.67,6.77,124.21,4.48,12.9-26.88,225.71-28.47,243.45,0,0-92.94,36.25-28.6,40.85,64.34,4.6,64.34-11.74,64.34-11.74,0,0,58.23-250.72,58.23-250.72`;

    return `
    <svg viewBox="0 0 347.7 697.75" xmlns="http://www.w3.org/2000/svg"
         style="width:100%;height:100%;"
         data-uid="${uid}"
         class="silhouette-svg">
        <defs>
            <!-- Clip for filling from bottom to top -->
            <clipPath id="fill-clip-${uid}">
                <rect id="fill-rect-${uid}" x="0" y="697.75" width="347.7" height="0"/>
            </clipPath>
        </defs>

        <!-- === FILLED VERSION (Clipped) === -->
        <g clip-path="url(#fill-clip-${uid})">
            <path d="${figurePath}"
                  id="fill-path-${uid}"
                  fill="none" stroke="none"/>
        </g>

        <!-- === OUTLINE (Always visible) === -->
        <path d="${figurePath}"
              fill="none" stroke="#000"
              stroke-width="15" stroke-miterlimit="10"/>

        <!-- Clickable Area -->
        <rect class="click-zone"
              data-group="${groupId}"
              data-fig="${figIndex}"
              x="0" y="0"
              width="347.7" height="697.75"
              fill="transparent"
              style="cursor:pointer;"/>
    </svg>`;
}

// ========== INIT SCALES ==========
function initScales() {
    const container = document.getElementById('scales-section');
    container.innerHTML = '';

    scalesData.forEach((scale, index) => {
        const row = document.createElement('div');
        row.className = 'scale-row';
        row.innerHTML = `
            <div class="scale-label-left">${scale.left}</div>
            <div class="scale-track" id="track-${index}">
                <div class="midline"></div>
                <div class="scale-dot dot-1" id="dot1-${index}" style="left:30%;" data-char="1"></div>
                <div class="scale-dot dot-2" id="dot2-${index}" style="left:70%;" data-char="2"></div>
            </div>
            <div class="scale-label-right">${scale.right}</div>
        `;
        container.appendChild(row);
    });

    document.querySelectorAll('.scale-dot').forEach(dot => {
        makeDraggable(dot);
    });
}

// ========== INIT FIGURES ==========
function initFigures() {
    const container = document.getElementById('figures-section');
    container.innerHTML = '';

    figureGroups.forEach(group => {
        const div = document.createElement('div');
        div.className = 'figure-group';
        div.innerHTML = `
            <div class="figure-group-title">${group.title}</div>
            <div class="figure-bodies">
                <div class="figure-body" id="fig-${group.id}-1">
                    ${createSilhouetteSVG(group.id, 1)}
                </div>
                <div class="figure-body" id="fig-${group.id}-2">
                    ${createSilhouetteSVG(group.id, 2)}
                </div>
            </div>
        `;
        container.appendChild(div);
    });

    document.querySelectorAll('.click-zone').forEach(zone => {
        let isDragging = false;

        zone.addEventListener('mousedown', (e) => {
            isDragging = true;
            handleFigurePointer(e, zone);
        });

        zone.addEventListener('mousemove', (e) => {
            if (isDragging) handleFigurePointer(e, zone);
        });

        document.addEventListener('mouseup', () => { isDragging = false; });

        zone.addEventListener('touchstart', (e) => {
            isDragging = true;
            handleFigurePointer(e.touches[0], zone);
            e.preventDefault();
        }, { passive: false });

        zone.addEventListener('touchmove', (e) => {
            if (isDragging) handleFigurePointer(e.touches[0], zone);
            e.preventDefault();
        }, { passive: false });

        document.addEventListener('touchend', () => { isDragging = false; });
    });
}

// ========== FIGURE FILL ==========
const figureFillLevels = {};

function handleFigurePointer(e, zone) {
    const group = zone.dataset.group;
    const fig = zone.dataset.fig;
    const key = `${group}-${fig}`;
    const charIndex = fig;
    const color = charColors[charIndex];

    const svg = zone.closest('svg');
    const svgRect = svg.getBoundingClientRect();

    const clientY = e.clientY !== undefined ? e.clientY : e.y;
    const relativeY = clientY - svgRect.top;
    const svgHeight = svgRect.height;

    let fillFraction = 1.0 - (relativeY / svgHeight);
    fillFraction = Math.max(0, Math.min(1, fillFraction));
    fillFraction = Math.round(fillFraction * 20) / 20;

    figureFillLevels[key] = fillFraction;
    updateFigureFill(group, fig, fillFraction, color);
}

function updateFigureFill(group, fig, fillFraction, color) {
    const uid = `${group}-${fig}`;
    const totalHeight = 697.75; // SVG viewBox height

    const fillHeight = totalHeight * fillFraction;
    const fillY = totalHeight - fillHeight;

    const fillRect = document.getElementById(`fill-rect-${uid}`);
    const fillPath = document.getElementById(`fill-path-${uid}`);

    if (fillRect) {
        fillRect.setAttribute('y', fillY);
        fillRect.setAttribute('height', fillHeight);
    }

    if (fillPath) {
        fillPath.setAttribute('fill', fillFraction > 0 ? color : 'none');
    }
}

// ========== DRAGGABLE DOTS ==========
function makeDraggable(dot) {
    let isDragging = false;

    const onStart = (e) => {
        isDragging = true;
        e.preventDefault();
        document.addEventListener('mousemove', onMove);
        document.addEventListener('mouseup', onEnd);
        document.addEventListener('touchmove', onMove, { passive: false });
        document.addEventListener('touchend', onEnd);
        dot.style.cursor = 'grabbing';
    };

    const onMove = (e) => {
        if (!isDragging) return;
        e.preventDefault();

        const track = dot.parentElement;
        const rect = track.getBoundingClientRect();
        const clientX = e.touches ? e.touches[0].clientX : e.clientX;

        let x = clientX - rect.left;
        x = Math.max(0, Math.min(x, rect.width));
        const percent = (x / rect.width) * 100;

        dot.style.left = percent + '%';
    };

    const onEnd = () => {
        isDragging = false;
        dot.style.cursor = 'grab';
        document.removeEventListener('mousemove', onMove);
        document.removeEventListener('mouseup', onEnd);
        document.removeEventListener('touchmove', onMove);
        document.removeEventListener('touchend', onEnd);
    };

    dot.addEventListener('mousedown', onStart);
    dot.addEventListener('touchstart', onStart, { passive: false });
}

// ========== PORTRAIT LOADING ==========
function loadPortrait(charNum, input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º div –∏ background-image –≤–º–µ—Å—Ç–æ img src
            const div = document.getElementById(`portrait${charNum}-img`);
            const placeholder = document.getElementById(`portrait${charNum}-placeholder`);
            
            div.style.backgroundImage = `url(${e.target.result})`;
            div.style.display = 'block';
            placeholder.style.display = 'none';
        };
        reader.readAsDataURL(input.files[0]);
    }
}

// ========== CALCULATE DIFFERENCES ==========
function calcDiff(type) {
    const v1 = parseFloat(document.getElementById(`${type}1`).value) || 0;
    const v2 = parseFloat(document.getElementById(`${type}2`).value) || 0;
    const diff = Math.abs(v1 - v2);

    if (type === 'height') {
        document.getElementById('height-diff').value = diff > 0 ? diff + ' —Å–º' : '‚Äî';
    } else {
        document.getElementById('age-diff').value = diff > 0 ? diff + ' –ª–µ—Ç' : '‚Äî';
    }
}

// ========== UPDATE CHARACTER COLORS ==========
function updateCharColor(charNum, color) {
    charColors[charNum] = color;

    document.getElementById(`swatch${charNum}`).style.background = color;

    document.querySelectorAll(`.scale-dot.dot-${charNum}`).forEach(dot => {
        dot.style.background = color;
    });

    figureGroups.forEach(group => {
        const key = `${group.id}-${charNum}`;
        const level = figureFillLevels[key] || 0;
        if (level > 0) {
            updateFigureFill(group.id, charNum, level, color);
        }
    });
}

// ========== SAVE TO PNG ==========
function saveToPNG() {
    const container = document.getElementById('sheet-container');
    const instructions = document.querySelector('.instructions');
    if (instructions) instructions.style.display = 'none';

    html2canvas(container, {
        scale: 2,
        backgroundColor: '#ffffff',
        useCORS: true,
        allowTaint: true,
        logging: false
    }).then(canvas => {
        const link = document.createElement('a');
        link.download = 'ship-sheet.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
        if (instructions) instructions.style.display = '';
    }).catch(err => {
        console.error('Error saving:', err);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.');
        if (instructions) instructions.style.display = '';
    });
}

// ========== RESET ==========
function resetAll() {
    if (!confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ?')) return;

    document.querySelectorAll('input[type="text"], input[type="number"]').forEach(i => i.value = '');
    document.getElementById('height-diff').value = '‚Äî';
    document.getElementById('age-diff').value = '‚Äî';

    [1, 2].forEach(n => {
        // –°–±—Ä–æ—Å –¥–ª—è Div-–∫–∞—Ä—Ç–∏–Ω–∫–∏
        const div = document.getElementById(`portrait${n}-img`);
        div.style.display = 'none';
        div.style.backgroundImage = '';
        document.getElementById(`portrait${n}-placeholder`).style.display = '';
        document.getElementById(`portrait${n}-input`).value = '';
    });

    charColors = { 1: '#6a5acd', 2: '#2ea82e' };
    document.getElementById('color1').value = '#6a5acd';
    document.getElementById('color2').value = '#2ea82e';
    document.getElementById('swatch1').style.background = '#6a5acd';
    document.getElementById('swatch2').style.background = '#2ea82e';

    document.querySelectorAll('.scale-dot.dot-1').forEach(d => {
        d.style.left = '30%';
        d.style.background = '#6a5acd';
    });
    document.querySelectorAll('.scale-dot.dot-2').forEach(d => {
        d.style.left = '70%';
        d.style.background = '#2ea82e';
    });

    Object.keys(figureFillLevels).forEach(k => { figureFillLevels[k] = 0; });
    figureGroups.forEach(group => {
        [1, 2].forEach(fig => {
            updateFigureFill(group.id, fig, 0, '#000');
        });
    });

    document.getElementById('orient-select-1').value = '';
    document.getElementById('orient-select-2').value = '';
    setOrientation(1, '');
    setOrientation(2, '');
}

// ========== INITIALIZE ==========
window.addEventListener('DOMContentLoaded', () => {
    initScales();
    initFigures();
});
</script>

</body>
</html>